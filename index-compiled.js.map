{"version":3,"sources":["index.js"],"names":[],"mappings":"AAAA;;AACA,MAAM,OAAO,QAAQ,MAAR,CAAP;AACN,MAAM,SAAS,KAAK,YAAL,EAAT;AACN,MAAM,KAAK,QAAQ,IAAR,CAAL;AACN,MAAM,OAAO,QAAQ,MAAR,CAAP;AACN,MAAM,MAAM,QAAQ,KAAR,CAAN;AACN,MAAM,UAAU,QAAQ,aAAR,CAAV;AACN,MAAM,IAAI,QAAQ,YAAR,CAAJ;;;AAGN,IAAI,YAAY,CACd;AACE,MAAI,GAAJ;AACA,SAAO,IAAP;AACA,UAAQ,KAAR;AACA,eAAa,IAAb;CALY,EAOd;AACE,MAAI,GAAJ;AACA,SAAO,KAAP;AACA,UAAQ,KAAR;AACA,eAAa,KAAb;CAXY,EAad;AACE,MAAI,GAAJ;AACA,SAAO,MAAP;AACA,UAAQ,aAAR;AACA,eAAa,IAAb;CAjBY,EAmBd;AACE,MAAI,GAAJ;AACA,SAAO,QAAP;AACA,UAAQ,KAAR;AACA,eAAa,IAAb;CAvBY,EAyBd;AACE,MAAI,GAAJ;AACA,SAAO,MAAP;AACA,UAAQ,KAAR;AACA,eAAa,KAAb;CA7BY,CAAZ;;;AAkCJ,MAAM,aAAa,uBAAb;AACN,MAAM,WAAW,qBAAX;;;AAGN,OAAO,EAAP,CAAU,SAAV,EAAoB,CAAC,GAAD,EAAK,GAAL,KAAa;AAC/B,MAAI,SAAS,IAAI,MAAJ,CADkB;AAE/B,MAAI,SAAS,IAAI,KAAJ,CAAU,IAAI,GAAJ,CAAnB,CAF2B;AAG/B,MAAI,WAAW,OAAO,QAAP,CAHgB;;AAK/B,MAAI,aAAa,GAAb,EAAkB;AACpB,OAAG,QAAH,CAAY,KAAK,IAAL,CAAU,SAAV,EAAqB,YAArB,CAAZ,EAAgD,MAAhD,EAAwD,CAAC,GAAD,EAAM,IAAN,KAAc;AACpE,UAAI,GAAJ,EAAS;AACP,eAAO,QAAQ,GAAR,CAAY,IAAI,GAAJ,CAAQ,IAAI,OAAJ,CAApB,CAAP,CADO;OAAT;AAGA,UAAI,cAAc,EAAE,QAAF,CAAW,IAAX,CAAd,CAJgE;AAKpE,UAAI,UAAU,YAAY;AACxB,iBADwB;OAAZ,CAAV,CALgE;AAQpE,UAAI,SAAJ,CAAc,GAAd,EAAmB;AACjB,wBAAgB,0BAAhB;OADF,EARoE;AAWpE,UAAI,GAAJ,CAAQ,OAAR,EAXoE;KAAd,CAAxD,CADoB;GAAtB,MAcO,IAAI,UAAU,KAAV,IAAmB,YAAY,MAAZ,EAAoB;;AAEhD,OAAG,QAAH,CAAY,KAAK,IAAL,CAAU,SAAV,EAAqB,UAArB,CAAZ,EAA8C,MAA9C,EAAsD,CAAC,GAAD,EAAM,IAAN,KAAc;AAClE,UAAI,GAAJ,EAAS;AACP,eAAO,IAAI,GAAJ,CAAQ,IAAI,OAAJ,CAAf,CADO;OAAT;AAGA,UAAI,SAAJ,CAAc,GAAd,EAAmB;AACjB,wBAAgB,0BAAhB;OADF,EAJkE;AAOlE,UAAI,GAAJ,CAAQ,IAAR,EAPkE;KAAd,CAAtD,CAFgD;GAA3C,MAWA,IAAI,WAAW,MAAX,IAAqB,aAAa,MAAb,EAAqB;;AAEnD,mBAAe,GAAf,EAAoB,YAAc;;AAEhC,UAAI,KAAK,SAAS,EAAT,CAFuB;AAGhC,UAAI,QAAQ,SAAS,KAAT,CAHoB;AAIhC,UAAI,SAAS,SAAS,MAAT,CAJmB;AAKhC,UAAI,cAAc,SAAS,YAAT;;;;;AALc,UAU5B,YAAY,UAAU,IAAV,CAAe,KAAI,EAAE,EAAF,KAAS,EAAT,CAA/B;;;AAV4B,UAa5B,SAAJ,EAAe;AACb,eAAO,IAAI,GAAJ,CAAQ,iBAAR,CAAP,CADa;OAAf;;AAIA,oBAAc,eAAe,GAAf,GAAqB,IAArB,GAA4B,KAA5B,CAjBkB;;AAmBhC,gBAAU,IAAV,CAAe;AACb,UADa,EACT,KADS,EACF,MADE,EACM,WADN;OAAf;;;AAnBgC,SAwBhC,CAAI,SAAJ,CAAc,GAAd,EAAmB;AACjB,oBAAY,wBAAZ;OADF,EAxBgC;AA2BhC,UAAI,GAAJ,GA3BgC;KAAd,CAApB,CAFmD;GAA9C,MAgCA,IAAI,WAAW,KAAX,IAAoB,WAAW,IAAX,CAAgB,QAAhB,CAApB,EAA+C;AACxD,QAAI,OAAO,SAAS,KAAT,CAAe,UAAf,EAA2B,CAA3B,CAAP,CADoD;AAExD,QAAI,QAAQ,UAAU,SAAV,CAAoB,KAAK,EAAE,EAAF,KAAS,IAAT,CAAjC,CAFoD;AAGxD,QAAI;AACF,gBAAU,MAAV,CAAiB,KAAjB,EAAwB,CAAxB,EADE;AAEF,UAAI,GAAJ,CAAQ,KAAK,SAAL,CAAe;AACrB,cAAM,CAAN;AACA,aAAK,IAAL;OAFM,CAAR,EAFE;KAAJ,CAME,OAAO,CAAP,EAAU;AACV,UAAI,GAAJ,CAAQ,KAAK,SAAL,CAAe;AACrB,cAAM,GAAN;AACA,aAAK,EAAE,OAAF;OAFC,CAAR,EADU;KAAV;GATG,MAeD,IAAG,WAAW,KAAX,IAAoB,SAAS,IAAT,CAAc,QAAd,CAApB,EAA4C;AACnD,QAAI,OAAO,SAAS,KAAT,CAAe,QAAf,EAAyB,CAAzB,CAAP,CAD+C;AAEnD,QAAI,YAAY,UAAU,IAAV,CAAe,KAAK,SAAS,EAAE,EAAF,CAAzC,CAF+C;AAGnD,OAAG,QAAH,CAAY,KAAK,IAAL,CAAU,SAAV,EAAoB,WAApB,CAAZ,EAA6C,MAA7C,EAAoD,CAAC,GAAD,EAAK,IAAL,KAAc;AAChE,UAAG,GAAH,EAAO;AACL,eAAO,IAAI,GAAJ,CAAQ,IAAI,OAAJ,CAAf,CADK;OAAP;;AADgE,UAK5D,cAAc,EAAE,QAAF,CAAW,IAAX,CAAd,CAL4D;AAMhE,UAAI,UAAU,YAAY;AACxB,iBADwB;OAAZ,CAAV,CAN4D;AAShE,UAAI,SAAJ,CAAc,GAAd,EAAkB;AAChB,wBAAe,0BAAf;OADF,EATgE;AAYhE,UAAI,GAAJ,CAAQ,OAAR,EAZgE;KAAd,CAApD,CAHmD;GAA/C,MAkBA,IAAG,WAAW,MAAX,IAAqB,SAAS,IAAT,CAAc,QAAd,CAArB,EAA6C;AACpD,mBAAe,GAAf,EAAmB,YAAY;AAC7B,UAAI,OAAO,SAAS,KAAT,CAAe,QAAf,EAAyB,CAAzB,CAAP,CADyB;AAE7B,UAAI,QAAQ,SAAS,KAAT,CAFiB;AAG7B,UAAI,SAAS,SAAS,MAAT,CAHgB;AAI7B,UAAI,cAAc,SAAS,WAAT,CAJW;;AAM7B,UAAI,QAAQ,UAAU,SAAV,CAAoB,KAAK,EAAE,EAAF,KAAS,IAAT,CAAjC,CANyB;AAO7B,gBAAU,KAAV,EAAiB,KAAjB,GAAyB,KAAzB,CAP6B;AAQ7B,gBAAU,KAAV,EAAiB,MAAjB,GAA0B,MAA1B,CAR6B;AAS7B,gBAAU,KAAV,EAAiB,WAAjB,GAA+B,eAAe,CAAf,GAAkB,IAAlB,GAAuB,KAAvB,CATF;;AAW7B,UAAI,SAAJ,CAAc,GAAd,EAAkB;AAChB,kBAAS,GAAT;OADF,EAX6B;AAc7B,UAAI,GAAJ,GAd6B;KAAZ,CAAnB,CADoD;GAAhD,MAkBC,IAAG,aAAa,qCAAb,EAAmD;AAC3D,OAAG,QAAH,CAAY,KAAK,IAAL,CAAU,SAAV,EAAoB,oCAApB,CAAZ,EAAsE,CAAC,GAAD,EAAK,IAAL,KAAY;AAChF,UAAG,GAAH,EAAO;AACL,eAAO,IAAI,GAAJ,CAAQ,IAAI,OAAJ,CAAf,CADK;OAAP;AAGA,UAAI,SAAJ,CAAc,GAAd,EAAkB;AAChB,wBAAe,wCAAf;OADF,EAJgF;AAOhF,UAAI,GAAJ,CAAQ,IAAR,EAPgF;KAAZ,CAAtE,CAD2D;GAAtD;CAjHW,CAApB;;AA+HA,OAAO,MAAP,CAAc,IAAd,EAAmB,MAAI;AACrB,UAAQ,GAAR,CAAY,cAAZ,EADqB;CAAJ,CAAnB;;AAIA,SAAS,cAAT,CAAwB,GAAxB,EAA4B,QAA5B,EAAqC;AACnC,MAAI,OAAO,EAAP,CAD+B;AAEnC,MAAI,EAAJ,CAAO,MAAP,EAAc,SAAS;AACrB,YAAQ,KAAR,CADqB;GAAT,CAAd,CAFmC;AAKnC,MAAI,EAAJ,CAAO,KAAP,EAAa,MAAI;AACf,QAAI,WAAW,QAAQ,KAAR,CAAc,IAAd,CAAX,CADW;AAEf,aAAS,QAAT,EAFe;GAAJ,CAAb,CALmC;CAArC","file":"index-compiled.js","sourcesContent":["\"use strict\";\r\nconst http = require('http');\r\nconst server = http.createServer();\r\nconst fs = require('fs');\r\nconst path = require('path');\r\nconst url = require('url');\r\nconst qstring = require('querystring');\r\nconst _ = require('underscore');\r\n\r\n// 定义一组数据\r\nlet musicList = [\r\n  {\r\n    id: '1',\r\n    title: '演员',\r\n    singer: '薛之谦',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '2',\r\n    title: '丑八怪',\r\n    singer: '薛之谦',\r\n    isHightRate: false\r\n  },\r\n  {\r\n    id: '3',\r\n    title: 'Fade',\r\n    singer: 'Alan Walker',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '4',\r\n    title: '想着你的感觉',\r\n    singer: '容祖儿',\r\n    isHightRate: true\r\n  },\r\n  {\r\n    id: '5',\r\n    title: '叽咕叽咕',\r\n    singer: '徐佳莹',\r\n    isHightRate: false\r\n  }\r\n]\r\n\r\n// 匹配删除链接的url\r\nconst reg_remove = /^\\/remove\\/(\\d{1,6})$/;\r\nconst reg_edit = /^\\/edit\\/(\\d{1,6})$/;\r\n\r\n// 创建服务器\r\nserver.on('request',(req,res) => {\r\n  let method = req.method;\r\n  let urlObj = url.parse(req.url);\r\n  let pathname = urlObj.pathname;\r\n\r\n  if (pathname === '/') {\r\n    fs.readFile(path.join(__dirname, 'index.html'), 'utf8', (err, data)=> {\r\n      if (err) {\r\n        return console.log(res.end(err.message));\r\n      }\r\n      let complieFunc = _.template(data);\r\n      let htmlStr = complieFunc({\r\n        musicList\r\n      });\r\n      res.writeHead(200, {\r\n        'Content-Type': 'text/html; charset=utf-8'\r\n      });\r\n      res.end(htmlStr);\r\n    });\r\n  } else if (method == 'GET' && pathname == '/add') {\r\n    // 客户端请求add页面\r\n    fs.readFile(path.join(__dirname, 'add.html'), 'utf8', (err, data)=> {\r\n      if (err) {\r\n        return res.end(err.message);\r\n      }\r\n      res.writeHead(200, {\r\n        'Content-Type': 'text/html; charset=utf-8'\r\n      });\r\n      res.end(data);\r\n    })\r\n  } else if (method === 'POST' && pathname === '/add') {\r\n    // 客户端传输数据 ,需要解析事件\r\n    handlePostData(req, (queryObj) => {\r\n      // 处理数据\r\n      let id = queryObj.id;\r\n      let title = queryObj.title;\r\n      let singer = queryObj.singer;\r\n      let isHightRate = queryObj.isHeightRate;\r\n\r\n      // 当然这里需要判断数据格式 ， 省略 ...\r\n\r\n      // 先判断这条音乐是否在列表中\r\n      let musicInfo = musicList.find(m=> m.id === id);\r\n\r\n      // 如果存在，那么返回客户端 存在信息\r\n      if (musicInfo) {\r\n        return res.end('music is exsits');\r\n      }\r\n\r\n      isHightRate = isHightRate == '1' ? true : false;\r\n\r\n      musicList.push({\r\n        id, title, singer, isHightRate\r\n      });\r\n\r\n      // 然后临时重定向到列表\r\n      res.writeHead(302, {\r\n        'Location': 'http://localhost:3000/'\r\n      });\r\n      res.end();\r\n\r\n    });\r\n  } else if (method === 'GET' && reg_remove.test(pathname)) {\r\n    let m_id = pathname.match(reg_remove)[1];\r\n    let index = musicList.findIndex(m => m.id === m_id);\r\n    try {\r\n      musicList.splice(index, 1);\r\n      res.end(JSON.stringify({\r\n        code: 1,\r\n        msg: 'ok'\r\n      }));\r\n    } catch (e) {\r\n      res.end(JSON.stringify({\r\n        code: '0',\r\n        msg: e.message\r\n      }))\r\n    }\r\n  }else if(method === 'GET' && reg_edit.test(pathname)){\r\n    let m_id = pathname.match(reg_edit)[1];\r\n    let musicInfo = musicList.find(m => m_id === m.id);\r\n    fs.readFile(path.join(__dirname,'edit.html'),'utf8',(err,data) => {\r\n      if(err){\r\n        return res.end(err.message);\r\n      }\r\n      // 渲染页面\r\n      let complieFunc = _.template(data);\r\n      let htmlStr = complieFunc({\r\n        musicInfo\r\n      })\r\n      res.writeHead(200,{\r\n        'Content-Type':'text/html; charset=utf-8'\r\n      });\r\n      res.end(htmlStr);\r\n    })\r\n\r\n  }else if(method === 'POST' && reg_edit.test(pathname)){\r\n    handlePostData(req,(queryObj)=>{\r\n      let m_id = pathname.match(reg_edit)[1];\r\n      let title = queryObj.title;\r\n      let singer = queryObj.singer;\r\n      let isHightRate = queryObj.isHightRate;\r\n\r\n      let index = musicList.findIndex(m => m.id === m_id);\r\n      musicList[index].title = title;\r\n      musicList[index].singer = singer;\r\n      musicList[index].isHightRate = isHightRate == 1? true:false;\r\n\r\n      res.writeHead(302,{\r\n        location:'/'\r\n      });\r\n      res.end();\r\n\r\n    })\r\n  } else if(pathname === '/node_modules/jquery/dist/jquery.js'){\r\n    fs.readFile(path.join(__dirname,'node_modules/jquery/dist/jquery.js'),(err,data)=>{\r\n      if(err){\r\n        return res.end(err.message);\r\n      }\r\n      res.writeHead(200,{\r\n        'Content-Type':'application/x-javascript; charset=utf8'\r\n      });\r\n      res.end(data);\r\n    })\r\n  }\r\n\r\n});\r\n\r\nserver.listen(3000,()=>{\r\n  console.log('server is on');\r\n})\r\n\r\nfunction handlePostData(req,callback){\r\n  let data = '';\r\n  req.on('data',(chunk)=>{\r\n    data += chunk;\r\n  });\r\n  req.on('end',()=>{\r\n    let queryObj = qstring.parse(data);\r\n    callback(queryObj);\r\n  })\r\n}"]}